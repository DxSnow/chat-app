# 测试应用指南

## 🔧 刚才修复的问题

修复了在没有 MongoDB 连接时 API 会报错的问题。现在即使不配置数据库,API 也能正常工作。

---

## 🔄 重启后端服务器

**在后端终端(运行着 `npm start` 的那个):**

1. 按 `Ctrl + C` 停止服务器
2. 重新启动:
   ```bash
   npm start
   ```

**前端不需要重启**,保持运行即可。

---

## ✅ 测试步骤

### 1. 检查服务状态

**后端终端应该显示:**

```
Server running on http://localhost:3001
WebSocket server running on ws://localhost:3001
No MONGODB_URI found. Running in memory-only mode.
```

**前端终端应该显示:**

```
VITE v7.x.x  ready in xxx ms
➜  Local:   http://localhost:5173/
```

### 2. 打开浏览器

访问: **http://localhost:5173/**

你应该看到:

- ✅ 聊天界面
- ✅ 顶部显示 "Chat"
- ✅ 右上角显示连接状态(绿点 = Connected)
- ✅ 底部有输入框和发送按钮

### 3. 测试单窗口聊天

在输入框输入消息,点击"Send"或按回车:

- ✅ 消息显示在右侧(蓝色气泡)
- ✅ 显示发送时间
- ✅ 自动滚动到最新消息

### 4. 测试多窗口实时聊天

**打开第二个浏览器窗口/标签:**

1. 访问 http://localhost:5173/
2. 在第一个窗口发送消息
3. 第二个窗口应该**实时收到**消息(左侧,白色气泡)
4. 在第二个窗口回复
5. 第一个窗口应该实时收到

### 5. 测试连接状态

1. 停止后端服务器(Ctrl+C)
2. 浏览器右上角应该变成红点 "Disconnected"
3. 重启后端服务器
4. 应该自动重连,变回绿点 "Connected"

### 6. 测试刷新页面

**不配置 MongoDB 时:**

- 刷新页面,消息会消失(内存模式)

**配置 MongoDB 后:**

- 刷新页面,消息保留
- 历史消息自动加载

---

## 📱 测试响应式设计

### 桌面视图

- 消息宽度最大 60%
- 输入框和按钮并排

### 调整浏览器窗口大小(模拟手机)

1. 按 `Command + Option + I` 打开开发者工具
2. 点击设备模拟图标(手机图标)
3. 选择 iPhone 或其他设备
4. 检查:
   - ✅ 消息宽度最大 70%
   - ✅ 界面自适应
   - ✅ 触摸友好

---

## 🎯 预期结果

### ✅ 应该工作的功能

- [x] 发送消息
- [x] 接收消息
- [x] 实时通信
- [x] 连接状态显示
- [x] 消息时间戳
- [x] 自动滚动
- [x] 响应式设计
- [x] API 不报错(即使没有 MongoDB)

### ℹ️ 内存模式限制

- [ ] 重启后端,消息丢失
- [ ] 刷新页面,消息丢失

要解决这个,需要配置 MongoDB(见下方)

---

## 🔧 常见问题

### 问题: 连接状态一直是红色

**检查:**

```bash
# 后端是否在运行?
lsof -ti:3001

# 浏览器控制台有什么错误?
# 按 F12 查看
```

### 问题: 消息发不出去

**检查:**

1. 连接状态是否为绿色
2. 浏览器控制台(F12)是否有错误
3. 后端终端是否有错误日志

### 问题: 第二个窗口收不到消息

**检查:**

1. 两个窗口的连接状态都是绿色吗?
2. 后端终端显示 "New client connected" 了吗?

---

## 🗄️ 可选: 配置 MongoDB(持久化存储)

如果想让消息在重启后保留:

1. 访问 https://www.mongodb.com/cloud/atlas
2. 创建免费集群
3. 获取连接字符串
4. 编辑 `server/.env`:
   ```
   MONGODB_URI=你的连接字符串
   ```
5. 重启后端服务器

---

## 📊 测试检查清单

完成这些测试,确认应用正常工作:

- [ ] 后端服务器启动成功
- [ ] 前端应用启动成功
- [ ] 浏览器能访问 http://localhost:5173/
- [ ] 显示聊天界面
- [ ] 连接状态显示绿色
- [ ] 能发送消息
- [ ] 消息显示在右侧(蓝色)
- [ ] 打开第二个窗口
- [ ] 第二个窗口能实时收到消息(左侧白色)
- [ ] 两个窗口可以互相聊天
- [ ] 响应式设计工作正常
- [ ] 没有控制台错误

---

## 🎉 测试通过后

恭喜!你的聊天应用已经完全可用了!

**下一步可以:**

- 配置 MongoDB 实现消息持久化
- 自定义界面样式
- 添加用户认证
- 部署到生产环境

享受你的应用吧! 🚀
